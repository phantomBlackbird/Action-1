<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mini Player World - A-Frame (10x Smaller)</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        /* Mobile touch controls styling */
        #touch-controls {
            position: fixed;
            bottom: 30px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 20px;
            pointer-events: none;
            z-index: 1000;
        }
        
        .joystick-area {
            pointer-events: auto;
            width: 120px;
            height: 120px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 60px;
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: none;
        }
        
        .joystick {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 25px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            pointer-events: auto;
        }
        
        .action-btn {
            width: 70px;
            height: 70px;
            border-radius: 35px;
            background: rgba(0, 150, 255, 0.7);
            border: 3px solid rgba(255, 255, 255, 0.8);
            color: white;
            font-size: 16px;
            font-weight: bold;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            touch-action: manipulation;
            cursor: pointer;
        }
        
        .action-btn:active {
            transform: scale(0.95);
            background: rgba(0, 100, 200, 0.9);
        }
        
        #jump-btn {
            background: rgba(255, 100, 0, 0.7);
        }
        
        #jump-btn:active {
            background: rgba(200, 80, 0, 0.9);
        }
        
        /* UI Elements */
        #hud {
            position: fixed;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 18px;
            text-shadow: 2px 2px 2px black;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }
        
        #debug-info {
            position: fixed;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 14px;
            background: rgba(0,0,0,0.5);
            padding: 8px 15px;
            border-radius: 20px;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        /* Controls hint */
        #controls-hint {
            position: fixed;
            bottom: 180px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 14px;
            background: rgba(0,0,0,0.5);
            padding: 8px 20px;
            border-radius: 20px;
            z-index: 1000;
            backdrop-filter: blur(5px);
            text-align: center;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <!-- HUD Display -->
    <div id="hud">
        <div>üåà Mini World Explorer</div>
        <div>Position: <span id="pos-x">0</span>, <span id="pos-z">0</span></div>
    </div>
    
    <!-- Debug Info -->
    <div id="debug-info">Player Size: 10x smaller than original</div>
    
    <!-- Controls Hint -->
    <div id="controls-hint">‚¨ÜÔ∏è‚¨áÔ∏è‚¨ÖÔ∏è‚û°Ô∏è Move | ‚¨ÜÔ∏è Jump</div>
    
    <!-- Mobile Touch Controls -->
    <div id="touch-controls">
        <div class="joystick-area" id="move-joystick">
            <div class="joystick" id="joystick-handle"></div>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn" id="jump-btn">JUMP</button>
        </div>
    </div>
    
    <!-- A-Frame Scene -->
    <a-scene background="color: #87CEEB" shadow="type: pcfsoft">
        <!-- Assets -->
        <a-assets>
            <!-- Tiny Player Model - Now 0.05 scale (half of previous 0.1) -->
            <a-asset-item id="player-model" src="Player.glb"></a-asset-item>
            
            <!-- Environment Textures -->
            <img id="ground-texture" src="https://cdn.aframe.io/aframe-brand/examples/ground.jpg" crossorigin="anonymous">
        </a-assets>
        
        <!-- Third Person Camera Rig -->
        <a-entity id="camera-rig" position="0 0.3 0">
            <!-- Tiny Player Model - Now 0.05 scale (2x smaller than before) -->
            <a-entity id="player" position="0 0 0">
                <a-gltf-model src="#player-model" scale="0.05 0.05 0.05" position="0 0 0" animation-mixer></a-gltf-model>
                
                <!-- Simple player shadow -->
                <a-circle position="0 -0.1 0" rotation="-90 0 0" radius="0.15" color="#333" material="opacity: 0.3; transparent: true"></a-circle>
            </a-entity>
            
            <!-- Camera positioned behind the tiny player -->
            <a-camera id="camera" wasd-controls="enabled: false" look-controls="enabled: true" position="0 0.8 2.0" rotation="0 0 0"></a-camera>
        </a-entity>
        
        <!-- Enhanced Lighting -->
        <a-light type="ambient" color="#fff" intensity="0.6"></a-light>
        <a-light type="directional" position="2 5 3" intensity="1.2" castshadow="true" shadow-mapSize-width="2048" shadow-mapSize-height="2048"></a-light>
        <a-light type="point" position="0 3 0" intensity="0.5" color="#FFEECC"></a-light>
        
        <!-- Massive Ground for tiny player to explore -->
        <a-plane id="ground" rotation="-90 0 0" width="200" height="200" material="src: #ground-texture; repeat: 40 40; roughness: 0.8; metalness: 0.1" receive-shadow></a-plane>
        
        <!-- Decorative grid for scale reference -->
        <a-grid position="0 0.01 0" width="200" height="200" cell-size="1" material="color: #888; opacity: 0.15"></a-grid>
        
        <!-- Fun environment - Everything scaled for tiny player -->
        
        <!-- Giant mushrooms (trees look too big, so using mushrooms for scale) -->
        <a-cylinder position="-15 0.1 -20" radius="0.4" height="0.8" color="#8B4513" shadow></a-cylinder>
        <a-sphere position="-15 0.6 -20" radius="0.6" color="#FF6B6B" shadow></a-sphere>
        <a-sphere position="-14.5 1.0 -20.5" radius="0.3" color="#FF8E8E" shadow></a-sphere>
        
        <a-cylinder position="20 0.1 -15" radius="0.5" height="1.0" color="#8B4513" shadow></a-cylinder>
        <a-sphere position="20 0.7 -15" radius="0.7" color="#4ECDC4" shadow></a-sphere>
        <a-sphere position="19.5 1.2 -14.5" radius="0.4" color="#45B7AA" shadow></a-sphere>
        
        <a-cylinder position="-10 0.1 25" radius="0.3" height="0.6" color="#8B4513" shadow></a-cylinder>
        <a-sphere position="-10 0.5 25" radius="0.5" color="#FFE66D" shadow></a-sphere>
        
        <!-- Tiny houses for the tiny player -->
        <a-box position="-25 0.2 -30" width="3" height="0.4" depth="3" color="#A0522D" shadow></a-box>
        <a-box position="-25 0.8 -30" width="2.5" height="1.2" depth="2.5" color="#DEB887" shadow></a-box>
        <a-cone position="-25 1.6 -30" radius-bottom="1.5" radius-top="0" height="1.2" color="#8B4513" shadow></a-cone>
        <a-box position="-26.2 0.5 -29.2" width="0.4" height="0.6" depth="0.1" color="#654321"></a-box>
        
        <!-- Colorful crystals -->
        <a-cylinder position="30 0.1 20" radius="0.3" height="1.5" color="#FF69B4" shadow></a-cylinder>
        <a-cone position="30 1.0 20" radius-bottom="0.4" radius-top="0" height="0.8" color="#FF1493" shadow></a-cone>
        
        <a-cylinder position="35 0.1 15" radius="0.3" height="1.8" color="#4169E1" shadow></a-cylinder>
        <a-cone position="35 1.1 15" radius-bottom="0.4" radius-top="0" height="0.9" color="#1E90FF" shadow></a-cone>
        
        <!-- Stone circles (like miniature Stonehenge) -->
        <a-cylinder position="-5 0.15 40" radius="0.2" height="1.0" color="#A9A9A9" shadow></a-cylinder>
        <a-cylinder position="-3 0.15 42" radius="0.2" height="1.2" color="#A9A9A9" shadow></a-cylinder>
        <a-cylinder position="-1 0.15 40" radius="0.2" height="0.9" color="#A9A9A9" shadow></a-cylinder>
        <a-cylinder position="-3 0.15 38" radius="0.2" height="1.1" color="#A9A9A9" shadow></a-cylinder>
        
        <!-- Flower patches (colored spheres) -->
        <a-sphere position="-40 0.1 -10" radius="0.15" color="#FFB6C1" shadow></a-sphere>
        <a-sphere position="-39 0.1 -11" radius="0.15" color="#FFD700" shadow></a-sphere>
        <a-sphere position="-41 0.1 -11" radius="0.15" color="#9370DB" shadow></a-sphere>
        <a-sphere position="-40 0.1 -12" radius="0.15" color="#FFA07A" shadow></a-sphere>
        
        <a-sphere position="45 0.1 5" radius="0.2" color="#98FB98" shadow></a-sphere>
        <a-sphere position="46 0.1 6" radius="0.18" color="#87CEEB" shadow></a-sphere>
        <a-sphere position="44 0.1 6" radius="0.22" color="#DDA0DD" shadow></a-sphere>
        
        <!-- Tiny pond -->
        <a-circle position="10 0.05 40" rotation="-90 0 0" radius="3" color="#4169E1" material="opacity: 0.6; transparent: true"></a-circle>
        <a-torus position="10 0.1 40" radius="3" radius-tubular="0.05" rotation="90 0 0" color="#4682B4"></a-torus>
        
        <!-- Stepping stones -->
        <a-cylinder position="8 0.1 38" radius="0.4" height="0.1" color="#D3D3D3" shadow></a-cylinder>
        <a-cylinder position="10 0.1 36" radius="0.4" height="0.1" color="#D3D3D3" shadow></a-cylinder>
        <a-cylinder position="12 0.1 38" radius="0.4" height="0.1" color="#D3D3D3" shadow></a-cylinder>
        
        <!-- Little bridges/ramps -->
        <a-box position="-20 0.15 10" width="3" height="0.1" depth="1" color="#DEB887" rotation="0 0 5" shadow></a-box>
        <a-box position="-17 0.2 10" width="3" height="0.1" depth="1" color="#DEB887" rotation="0 0 -3" shadow></a-box>
    </a-scene>
    
    <script>
        // Game State
        let gameRunning = true;
        let joystickActive = false;
        let joystickVector = { x: 0, y: 0 };
        
        // Movement speed adjusted for tiny player
        let moveSpeed = 0.06;
        
        // DOM Elements
        const posXEl = document.getElementById('pos-x');
        const posZEl = document.getElementById('pos-z');
        
        // Touch Controls
        const moveJoystick = document.getElementById('move-joystick');
        const joystickHandle = document.getElementById('joystick-handle');
        const jumpBtn = document.getElementById('jump-btn');
        
        // A-Frame Elements
        const scene = document.querySelector('a-scene');
        const cameraRig = document.getElementById('camera-rig');
        const camera = document.getElementById('camera');
        const player = document.getElementById('player');
        
        // Joystick Logic
        moveJoystick.addEventListener('touchstart', (e) => {
            e.preventDefault();
            joystickActive = true;
            updateJoystick(e.touches[0]);
        });
        
        moveJoystick.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (joystickActive) {
                updateJoystick(e.touches[0]);
            }
        });
        
        moveJoystick.addEventListener('touchend', (e) => {
            e.preventDefault();
            joystickActive = false;
            joystickVector = { x: 0, y: 0 };
            joystickHandle.style.transform = 'translate(0px, 0px)';
        });
        
        function updateJoystick(touch) {
            const rect = moveJoystick.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            let deltaX = touch.clientX - centerX;
            let deltaY = touch.clientY - centerY;
            
            // Limit to joystick radius
            const maxDistance = 40;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            
            if (distance > maxDistance) {
                deltaX = (deltaX / distance) * maxDistance;
                deltaY = (deltaY / distance) * maxDistance;
            }
            
            joystickHandle.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
            
            // Normalize vector (-1 to 1)
            joystickVector.x = deltaX / maxDistance;
            joystickVector.y = deltaY / maxDistance;
        }
        
        // Jump Button
        jumpBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (gameRunning) {
                jump();
            }
        });
        
        // Jump Function
        function jump() {
            let pos = cameraRig.getAttribute('position');
            if (pos.y <= 0.35) { // Ground level check
                pos.y += 0.3; // Jump height
                cameraRig.setAttribute('position', pos);
                
                // Add a little squash and stretch effect?
                if (player) {
                    player.setAttribute('scale', '0.06 0.04 0.06');
                }
                
                // Gravity pull down
                setTimeout(() => {
                    let newPos = cameraRig.getAttribute('position');
                    newPos.y -= 0.3;
                    cameraRig.setAttribute('position', newPos);
                    
                    // Reset scale
                    if (player) {
                        player.setAttribute('scale', '0.05 0.05 0.05');
                    }
                }, 250);
            }
        }
        
        // Move player based on joystick
        function movePlayer() {
            if (!gameRunning || !joystickActive) return;
            
            const pos = cameraRig.getAttribute('position');
            const rot = camera.getAttribute('rotation');
            
            // Move relative to camera direction
            const radY = THREE.MathUtils.degToRad(rot.y);
            
            // Forward/backward movement
            if (joystickVector.y !== 0) {
                pos.x += Math.sin(radY) * joystickVector.y * moveSpeed * -1;
                pos.z += Math.cos(radY) * joystickVector.y * moveSpeed * -1;
            }
            
            // Left/right movement (strafe)
            if (joystickVector.x !== 0) {
                pos.x += Math.sin(radY + Math.PI/2) * joystickVector.x * moveSpeed;
                pos.z += Math.cos(radY + Math.PI/2) * joystickVector.x * moveSpeed;
            }
            
            // Keep player within bounds (massive world)
            pos.x = Math.max(-90, Math.min(90, pos.x));
            pos.z = Math.max(-90, Math.min(90, pos.z));
            
            cameraRig.setAttribute('position', pos);
            
            // Update position display
            posXEl.textContent = Math.round(pos.x * 10) / 10;
            posZEl.textContent = Math.round(pos.z * 10) / 10;
            
            // Simple idle animation - slight bob when moving
            if (joystickActive && player) {
                const time = Date.now() * 0.01;
                const bobY = Math.sin(time) * 0.01;
                player.setAttribute('position', { x: 0, y: bobY, z: 0 });
            } else if (player) {
                player.setAttribute('position', { x: 0, y: 0, z: 0 });
            }
        }
        
        // Game Loop
        function gameLoop() {
            if (gameRunning) {
                movePlayer();
            }
            requestAnimationFrame(gameLoop);
        }
        
        // Initialize when scene loads
        scene.addEventListener('loaded', () => {
            console.log('Scene loaded - Tiny player world!');
            
            // Set initial position
            cameraRig.setAttribute('position', { x: 0, y: 0.3, z: 0 });
            
            // Start game loop
            gameLoop();
        });
        
        // Keyboard controls for debugging
        window.addEventListener('keydown', (e) => {
            if (!gameRunning) return;
            
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    jump();
                    break;
                case 'ArrowUp':
                case 'w':
                case 'W':
                    // Handle through joystick? Just trigger jump for arrow up
                    if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        jump();
                    }
                    break;
            }
        });
        
        // Prevent default touch behaviors
        document.addEventListener('touchmove', (e) => {
            if (e.target.closest('#touch-controls')) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // Add some random floating particles for magic effect
        function createFloatingParticles() {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('a-sphere');
                    particle.setAttribute('radius', '0.05');
                    particle.setAttribute('color', `hsl(${Math.random() * 360}, 80%, 70%)`);
                    particle.setAttribute('position', {
                        x: (Math.random() - 0.5) * 80,
                        y: Math.random() * 5,
                        z: (Math.random() - 0.5) * 80
                    });
                    particle.setAttribute('animation', 'property: position; to: 0 10 0; dur: 5000; easing: linear; loop: true');
                    particle.setAttribute('material', 'transparent: true; opacity: 0.6');
                    scene.appendChild(particle);
                }, i * 200);
            }
        }
        
        // Add particles after scene loads
        setTimeout(createFloatingParticles, 2000);
    </script>
</body>
</html>
